<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… | Ø£Ø³Ø±Ø§Ø± Ø§Ù„Ø¬Ù…Ø§Ù„</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #5d001e; --gold: #d4af37; --bg: #f8f9fa; }
        body { font-family: 'Cairo', sans-serif; background: var(--bg); margin: 0; padding: 20px; display: none; }
        .admin-card { max-width: 800px; margin: auto; background: white; padding: 30px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.05); }
        h1 { color: var(--primary); text-align: center; border-bottom: 2px solid var(--gold); padding-bottom: 10px; }
        .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 20px; }
        .full-width { grid-column: 1 / -1; }
        label { display: block; margin-bottom: 5px; font-weight: bold; font-size: 14px; }
        input, select { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 10px; outline: none; font-family: 'Cairo'; transition: 0.3s; }
        input:focus { border-color: var(--primary); box-shadow: 0 0 5px rgba(93,0,30,0.1); }
        .btn-save { background: var(--primary); color: white; border: none; padding: 15px; width: 100%; border-radius: 10px; font-size: 18px; font-weight: bold; cursor: pointer; margin-top: 20px; }
        .btn-save:hover { background: #400015; }
        .inventory { margin-top: 40px; }
        .item { display: flex; align-items: center; background: #fff; padding: 15px; border-radius: 12px; margin-bottom: 10px; border: 1px solid #eee; }
        .item img { width: 50px; height: 50px; border-radius: 8px; object-fit: cover; margin-left: 15px; }
        .item-info { flex-grow: 1; }
        .btn-del { background: #ff4d4d; color: white; border: none; padding: 8px 15px; border-radius: 8px; cursor: pointer; }
        @media (max-width: 600px) { .form-grid { grid-template-columns: 1fr; } }
    </style>
</head>
<body>

<div class="admin-card">
    <h1>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…ØªØ¬Ø± âš™ï¸</h1>
    
    <div class="form-grid">
        <div>
            <label>Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬</label>
            <input type="text" id="p-name" placeholder="Ù…Ø«Ø§Ù„: Ø²ÙŠØª Ù…Ù„ÙƒÙŠ">
        </div>
        <div>
            <label>Ø§Ù„Ø³Ø¹Ø± (Ø±.Ø¹)</label>
            <input type="number" id="p-price" step="0.001" placeholder="0.000">
        </div>
        <div>
            <label>Ø§Ù„ØªØµÙ†ÙŠÙ</label>
            <select id="p-category">
                <option value="Ø¹Ø§Ù…">Ù‚Ø³Ù…: Ø¹Ø§Ù…</option>
                <option value="Ø¹Ù†Ø§ÙŠØ©">Ù‚Ø³Ù…: Ø¹Ù†Ø§ÙŠØ©</option>
                <option value="Ø¹Ø·ÙˆØ±">Ù‚Ø³Ù…: Ø¹Ø·ÙˆØ±</option>
                <option value="Ø¨Ø®ÙˆØ±">Ù‚Ø³Ù…: Ø¨Ø®ÙˆØ±</option>
            </select>
        </div>
        <div>
            <label>Ø§Ù„ÙˆØ³Ù…</label>
            <select id="p-badge">
                <option value="">Ø¨Ø¯ÙˆÙ† ÙˆØ³Ù…</option>
                <option value="Ø¬Ø¯ÙŠØ¯">Ø¬Ø¯ÙŠØ¯ âœ¨</option>
                <option value="Ø¹Ø±Ø¶ Ø®Ø§Øµ">Ø¹Ø±Ø¶ Ø®Ø§Øµ ğŸ</option>
                <option value="Ø§Ù„Ø£ÙƒØ«Ø± Ù…Ø¨ÙŠØ¹Ø§Ù‹">Ø§Ù„Ø£ÙƒØ«Ø± Ù…Ø¨ÙŠØ¹Ø§Ù‹ ğŸ”¥</option>
            </select>
        </div>
        <div class="full-width">
            <label>Ø§Ø³Ù… Ø§Ù„ØµÙˆØ±Ø© ÙÙŠ GitHub (Ù…Ø«Ù„Ø§Ù‹ oil.png)</label>
            <input type="text" id="p-img" placeholder="Ø§ÙƒØªØ¨ÙŠ Ø§Ø³Ù… Ø§Ù„ØµÙˆØ±Ø© ÙÙ‚Ø· Ø¥Ø°Ø§ ÙƒØ§Ù†Øª ÙÙŠ Ù…Ø¬Ù„Ø¯ images">
        </div>
    </div>

    <button class="btn-save" id="save-btn" onclick="saveProduct()">Ø¥Ø¶Ø§ÙØ© ÙˆØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…ØªØ¬Ø± Ø§Ù„Ø¢Ù†</button>

    <div class="inventory">
        <h3>Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø§Ù„Ø­Ø§Ù„ÙŠ:</h3>
        <div id="list">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª...</div>
    </div>
</div>

<script>
    // 1. Ù†Ø¸Ø§Ù… Ø§Ù„Ø­Ù…Ø§ÙŠØ©
    const masterPass = "2024";
    const userPass = prompt("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©:");
    if (userPass === masterPass) { document.body.style.display = "block"; } 
    else { alert("Ø®Ø·Ø£!"); window.location.href = "index.html"; }

    // 2. Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª GitHub (Ù…Ù‚Ø³Ù…Ø© Ù„Ù„Ø­Ù…Ø§ÙŠØ©)
    const partA = "ghp_"; 
    const partB = "BEJ0TzUJEYJj2RNxvHEG"; 
    const partC = "NpmFL9RPOp3mkmYm"; 

    const TOKEN = partA + partB + partC;
    const OWNER = "faissaltunisia";
    const REPO = "souk";

    let products = [];
    let sha = null;

    async function load() {
        try {
            const res = await fetch(`https://api.github.com/repos/${OWNER}/${REPO}/contents/products.json`, {
                headers: { "Authorization": `token ${TOKEN}` }
            });
            if (res.ok) {
                const data = await res.json();
                sha = data.sha;
                products = JSON.parse(decodeURIComponent(escape(atob(data.content))));
                render();
            } else { document.getElementById('list').innerText = "Ø§Ù„Ù…ØªØ¬Ø± ÙØ§Ø±Øº Ø­Ø§Ù„ÙŠØ§Ù‹."; }
        } catch (e) { console.error(e); }
    }

    function render() {
        const listDiv = document.getElementById('list');
        if (products.length === 0) { listDiv.innerText = "Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª."; return; }
        listDiv.innerHTML = products.map((p, i) => `
            <div class="item">
                <img src="${p.img}" onerror="this.src='https://via.placeholder.com/50'">
                <div class="item-info">
                    <strong>${p.name}</strong> <small>(${p.category})</small><br>
                    <span style="color:var(--primary)">${parseFloat(p.price).toFixed(3)} Ø±.Ø¹</span>
                </div>
                <button class="btn-del" onclick="deleteItem(${i})">Ø­Ø°Ù</button>
            </div>
        `).join('');
    }

    async function saveProduct() {
        const name = document.getElementById('p-name').value;
        const price = parseFloat(document.getElementById('p-price').value);
        const category = document.getElementById('p-category').value;
        const badge = document.getElementById('p-badge').value;
        let imgInput = document.getElementById('p-img').value;

        if (!name || isNaN(price) || !imgInput) return alert("Ø£ÙƒÙ…Ù„ÙŠ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");

        const finalImg = imgInput.startsWith('http') ? imgInput : `https://raw.githubusercontent.com/${OWNER}/${REPO}/main/images/${imgInput}`;

        const btn = document.getElementById('save-btn');
        btn.disabled = true; btn.innerText = "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø±ÙØ¹...";

        products.push({ id: Date.now(), name, price, category, badge, img: finalImg });
        
        await sync();
    }

    async function deleteItem(index) {
        if (confirm("Ø­Ø°Ù Ø§Ù„Ù…Ù†ØªØ¬ØŸ")) {
            products.splice(index, 1);
            await sync();
        }
    }

    async function sync() {
        const content = btoa(unescape(encodeURIComponent(JSON.stringify(products, null, 2))));
        const res = await fetch(`https://api.github.com/repos/${OWNER}/${REPO}/contents/products.json`, {
            method: "PUT",
            headers: { "Authorization": `token ${TOKEN}`, "Content-Type": "application/json" },
            body: JSON.stringify({ message: "Update", content, sha })
        });
        if (res.ok) { alert("ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ«!"); location.reload(); } 
        else { alert("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù€ GitHub"); }
    }

    load();
</script>
</body>
</html>
